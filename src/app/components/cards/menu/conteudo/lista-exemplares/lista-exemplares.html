<div class="lista-exemplares-root">
  <ng-container *ngIf="loading">Carregando exemplares...</ng-container>
  <ng-container *ngIf="error" class="error">{{ error }}</ng-container>

  <section>
    <h4>Exemplares ({{ exemplares.length }})</h4>
    <table class="table-exemplares">
      <thead>
        <tr>
          <th>ID</th>
          <th>Status</th>
          <th>Estado Físico</th>
          <th>Motivo de Exclusão</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let e of exemplares">
            <td>{{ getId(e) }}</td>
            <td>{{ getStatus(e) }}</td>
            <td>{{ getEstadoFisico(e) }}</td>
            <td>{{ e.motivoSolicitacaoExclusao || '—' }}</td>
            <td class="actions-cell">
              <button 
                class="btn-icon" 
                type="button" 
                (click)="abrirModalEdicao(e)"
                title="Editar exemplar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                </svg>
              </button>
              <button 
                class="btn-icon btn-icon-delete" 
                type="button" 
                (click)="handleExclusaoOuInativacao(e)"
                [title]="isBibliotecario() ? 'Solicitar exclusão' : 'Inativar exemplar'">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
              </button>
            </td>
        </tr>
      </tbody>
    </table>
  </section>

  <ng-container *ngIf="!loading && (!exemplares || exemplares.length === 0)">
    <p>Nenhum exemplar encontrado para esta edição.</p>
  </ng-container>
</div>

<!-- Modal de Edição -->
<div class="modal-overlay" *ngIf="mostrarModalEdicao" (click)="fecharModalEdicao()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h3>Editar Exemplar #{{ exemplarEditando?.idExemplar }}</h3>
    
    <div class="form-group">
      <label for="estadoFisicoEdit">Estado Físico: *</label>
      <select 
        id="estadoFisicoEdit" 
        [(ngModel)]="estadoFisicoEditado"
        class="form-control">
        <option value="">Selecione o estado físico</option>
        <option value="MUITO_RUIM">Muito Ruim</option>
        <option value="RUIM">Ruim</option>
        <option value="BOM">Bom</option>
        <option value="OTIMO">Ótimo</option>
        <option value="EXCELENTE">Excelente</option>
      </select>
    </div>

    <div class="modal-actions">
      <button class="btn btn-outline" type="button" (click)="fecharModalEdicao()">Cancelar</button>
      <button class="btn btn-primary" type="button" (click)="salvarEdicao()">Salvar</button>
    </div>
  </div>
</div>

<!-- Modal de Solicitação de Exclusão (BIBLIOTECARIO) -->
<div class="modal-overlay" *ngIf="mostrarModalExclusao" (click)="fecharModalExclusao()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h3>Solicitar Exclusão do Exemplar #{{ exemplarParaExcluir?.idExemplar }}</h3>
    
    <div class="form-group">
      <label for="motivoExclusao">Motivo da Exclusão: *</label>
      <textarea 
        id="motivoExclusao" 
        [(ngModel)]="motivoExclusao"
        class="form-control"
        rows="4"
        placeholder="Informe o motivo da solicitação de exclusão (mínimo 10 caracteres)"></textarea>
    </div>

    <div class="modal-actions">
      <button class="btn btn-outline" type="button" (click)="fecharModalExclusao()">Cancelar</button>
      <button class="btn btn-primary" type="button" (click)="confirmarSolicitacaoExclusao()">Solicitar Exclusão</button>
    </div>
  </div>
</div>
