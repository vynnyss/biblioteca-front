

<div class="lista-funcionarios-root">
	<div class="header-actions">
		<h2>Funcionários</h2>
		<button class="btn btn-primary" type="button" (click)="cadastrarNovoFuncionario()">
			+ Cadastrar Funcionário/Cliente
		</button>
	</div>

	<ng-container *ngIf="loadingAdmins || loadingFuncs">Carregando...</ng-container>
	<ng-container *ngIf="error" class="error">{{ error }}</ng-container>

	<div class="filters">
		<label>
			Nome
			<input type="text" [(ngModel)]="nameQuery" (input)="applyFilters()" placeholder="Pesquisar por nome" />
		</label>

		<label>
			Email
			<input type="text" [(ngModel)]="emailQuery" (input)="applyFilters()" placeholder="Pesquisar por email ou username" />
		</label>

		<label>
			Status
			<select [(ngModel)]="statusFilter" (change)="applyFilters()">
				<option value="">Todos</option>
				<option *ngFor="let s of availableStatuses" [value]="s">{{ s }}</option>
			</select>
		</label>

		<button class="btn btn-outline" type="button" (click)="clearFilters()">Limpar</button>
	</div>

	<section *ngIf="!loadingAdmins && administradores?.length">
		<h3>Administradores ({{ administradores.length }})</h3>
		<table class="clientes-table">
			<thead>
				<tr>
					<th>Nome</th>
					<th>Email</th>
					<th>Telefone</th>
					<th>Conta</th>
					<th *ngIf="isAdministrador()">Ações</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let a of administradores">
					<td>{{ a.nome }}</td>
					<td>{{ a.email.endereco || a.username }}</td>
					<td>{{ a.telefone.numero }}</td>
					<td>{{ a.statusConta }}</td>
					<td *ngIf="isAdministrador()">
						<button class="btn-icon" (click)="editarFuncionario(a.idPessoa)" title="Editar funcionário">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
							</svg>
						</button>
						<button class="btn-icon btn-icon-delete" (click)="abrirModalInativar(a)" title="Inativar funcionário">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<polyline points="3 6 5 6 21 6"></polyline>
								<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
							</svg>
						</button>
					</td>
				</tr>
			</tbody>
		</table>

		<!-- Pagination Controls for Administradores -->
		<div class="pagination-controls" *ngIf="totalPaginasAdmins > 1">
			<button class="btn-pagination" (click)="paginaAnteriorAdmins()" [disabled]="paginaAtualAdmins === 0">
				<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
					<path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
			</button>
			<button *ngFor="let pagina of getPaginasVisiveisAdmins()" 
					class="btn-pagination" 
					[class.active]="pagina === paginaAtualAdmins"
					(click)="irParaPaginaAdmins(pagina)">
				{{ pagina + 1 }}
			</button>
			<button class="btn-pagination" (click)="proximaPaginaAdmins()" [disabled]="paginaAtualAdmins === totalPaginasAdmins - 1">
				<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
					<path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
			</button>
		</div>
	</section>

	<section *ngIf="!loadingFuncs && funcionarios?.length" class="funcionarios-section">
		<h3>Funcionários ({{ funcionarios.length }})</h3>
		<table class="clientes-table">
			<thead>
				<tr>
					<th>Nome</th>
					<th>Email</th>
					<th>Telefone</th>
					<th>Conta</th>
					<th *ngIf="isAdministrador()">Ações</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let f of funcionarios">
					<td>{{ f.nome }}</td>
					<td>{{ f.email.endereco || f.username }}</td>
					<td>{{ f.telefone.numero }}</td>
					<td>{{ f.statusConta }}</td>
					<td *ngIf="isAdministrador()">
						<button class="btn-icon" (click)="editarFuncionario(f.idPessoa)" title="Editar funcionário">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
							</svg>
						</button>
						<button class="btn-icon btn-icon-delete" (click)="abrirModalInativar(f)" title="Inativar funcionário">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<polyline points="3 6 5 6 21 6"></polyline>
								<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
							</svg>
						</button>
					</td>
				</tr>
			</tbody>
		</table>

		<!-- Pagination Controls for Funcionarios -->
		<div class="pagination-controls" *ngIf="totalPaginasFuncs > 1">
			<button class="btn-pagination" (click)="paginaAnteriorFuncs()" [disabled]="paginaAtualFuncs === 0">
				<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
					<path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
			</button>
			<button *ngFor="let pagina of getPaginasVisiveisFuncs()" 
					class="btn-pagination" 
					[class.active]="pagina === paginaAtualFuncs"
					(click)="irParaPaginaFuncs(pagina)">
				{{ pagina + 1 }}
			</button>
			<button class="btn-pagination" (click)="proximaPaginaFuncs()" [disabled]="paginaAtualFuncs === totalPaginasFuncs - 1">
				<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
					<path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
			</button>
		</div>
	</section>

	<ng-container *ngIf="!loadingAdmins && !loadingFuncs && (!administradores?.length && !funcionarios?.length)">
		<p>Nenhum usuário encontrado.</p>
	</ng-container>

	<!-- Modal para inativar funcionário -->
	<div class="modal-overlay" *ngIf="mostrarModalInativar" (click)="fecharModalInativar()">
		<div class="modal-content" (click)="$event.stopPropagation()">
			<h4>Inativar Funcionário</h4>
			<p>Funcionário: <strong>{{ funcionarioInativando?.nome }}</strong></p>
			<label>
				Motivo da inativação: *
				<textarea 
					[(ngModel)]="motivoInativacao" 
					placeholder="Digite o motivo da inativação"
					class="textarea-motivo"
					rows="4"></textarea>
			</label>
			<div class="modal-actions">
				<button class="btn btn-outline" type="button" (click)="fecharModalInativar()">Cancelar</button>
				<button class="btn btn-danger" type="button" (click)="confirmarInativacao()">Confirmar Inativação</button>
			</div>
		</div>
	</div>
</div>

