<svg style="display: none;">
	<symbol id="icon-book" viewBox="0 0 24 24">
		<path d="M4 19h16v-1a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v1zm14.5-9L12 14.5 5.5 10a1 1 0 0 1-.5-.8V4a1 1 0 0 1 1-1h13a1 1 0 0 1 1 1v5.2a1 1 0 0 1-.5.8zM6 4v5.2l6 4 6-4V4H6z"/>
	</symbol>
</svg>

<main class="container book-detail-page">
	<section class="book-info-card">
		<div class="book-cover-container">
			<div class="book-cover large">
				<img 
					[src]="edicao?.imagemUrl || '/placeholder.svg?height=600&width=400'" 
					[alt]="(edicao?.titulo?.nome || 'Edi√ß√£o') + ' cover'"
				/>
			</div>
		</div>

		<div class="book-details-content">
			<p class="book-genre">{{ getCategories() }}</p>
			<h1 class="book-title">{{ edicao?.titulo?.nome }}</h1>
			<p class="book-author">Por <span>{{ getAuthor() }}</span></p>

			<div class="details-meta">
				<span>Ano de Publica√ß√£o: {{ getYear() }}</span>
			</div>

			<!-- No add-to-cart button here (details view only) -->

			<h2 class="section-title">Detalhes da Edi√ß√£o</h2>
			<div class="edition-details">
				<p><strong>Descri√ß√£o da Edi√ß√£o:</strong> {{ edicao?.descricaoEdicao || 'N√£o informado' }}</p>
				<p><strong>Editora:</strong> {{ edicao?.editora?.nome || 'N√£o informado' }}</p>
				<p><strong>Idioma:</strong> {{ edicao?.idioma?.nome || 'N√£o informado' }}</p>
				<p><strong>Quantidade de P√°ginas:</strong> {{ edicao?.qtdPaginas || 'N√£o informado' }}</p>
				<p><strong>Tipo de Capa:</strong> {{ formatTipoCapa() }}</p>
				<p><strong>Tamanho:</strong> {{ formatTamanho() }}</p>
				<p><strong>Classifica√ß√£o Indicativa:</strong> {{ formatClassificacao() }}</p>
			</div>

			<h2 class="section-title">Sinopse / Notas</h2>
			<p class="book-description">{{ edicao?.titulo?.descricao || 'Sem descri√ß√£o dispon√≠vel.' }}</p>

		</div>
	</section>

	<section class="debug-json" *ngIf="edicao">
			<!-- Lista de exemplares para esta edi√ß√£o -->
			<app-lista-exemplares [edicaoId]="edicao.idEdicao" [recarregar]="recarregarExemplares"></app-lista-exemplares>

			<div style="margin-top:1rem; display: flex; gap: 1rem;">
				<button class="btn btn-outline" type="button" (click)="onClose()">‚Üê Voltar</button>
				<button class="btn btn-primary" type="button" (click)="abrirModalEdicao()">‚úèÔ∏è Editar Edi√ß√£o</button>
				<button class="btn btn-primary" type="button" (click)="abrirModalNovoExemplar()">+ Adicionar Exemplares</button>
				<button *ngIf="userRole === 'ADMINISTRADOR'" class="btn btn-danger" type="button" (click)="inativarEdicao()">üóëÔ∏è Inativar Edi√ß√£o</button>
			</div>
		</section>

	<!-- Modal para cadastrar novo exemplar -->
	<div *ngIf="mostrarModalExemplar" class="modal-overlay" (click)="fecharModalExemplar()">
		<div class="modal-content" (click)="$event.stopPropagation()">
			<h3>Adicionar Exemplares</h3>
			
			<div class="form-group">
				<label for="estadoFisico">Estado F√≠sico: *</label>
				<select 
					id="estadoFisico" 
					name="estadoFisico"
					[(ngModel)]="novoExemplar.estadoFisico"
					required>
					<option value="">Selecione o estado f√≠sico</option>
					<option value="MUITO_RUIM">Muito Ruim</option>
					<option value="RUIM">Ruim</option>
					<option value="BOM">Bom</option>
					<option value="OTIMO">√ìtimo</option>
					<option value="EXCELENTE">Excelente</option>
				</select>
			</div>

			<div class="form-group">
				<label for="qtdEstoque">Quantidade de Exemplares: *</label>
				<input 
					type="number" 
					id="qtdEstoque" 
					name="qtdEstoque"
					[(ngModel)]="novoExemplar.qtdEstoque"
					min="1"
					placeholder="Ex: 5"
					required
				/>
				<small>Quantidade de exemplares que ser√£o adicionados</small>
			</div>

			<div class="modal-actions">
				<button type="button" class="btn btn-outline" (click)="fecharModalExemplar()">Cancelar</button>
				<button type="button" class="btn btn-primary" (click)="salvarNovoExemplar()">Salvar</button>
			</div>
		</div>
	</div>

	<!-- Modal para editar edi√ß√£o -->
	<div *ngIf="mostrarModalEdicao" class="modal-overlay" (click)="fecharModalEdicao()">
		<div class="modal-content modal-edicao" (click)="$event.stopPropagation()">
			<h3>Editar Edi√ß√£o</h3>
			
			<div class="form-group">
				<label for="buscaTitulo">Buscar T√≠tulo:</label>
				<input 
					id="buscaTitulo" 
					type="text"
					name="buscaTitulo"
					[(ngModel)]="termoBuscaTitulo"
					(ngModelChange)="filtrarTitulos()"
					class="form-control"
					placeholder="Digite para buscar...">
			</div>

			<div class="form-group">
				<label for="titulo">T√≠tulo: *</label>
				<select 
					id="titulo" 
					name="titulo" 
					[(ngModel)]="edicaoEditada.idTitulo"
					required>
					<option value="">Selecione um t√≠tulo</option>
					<option *ngFor="let titulo of titulosFiltrados" [value]="titulo.idTitulo">
						{{ titulo.nome }}
					</option>
				</select>
			</div>

			<div class="form-group">
				<label for="dataPublicacao">Data de Publica√ß√£o: *</label>
				<input
					type="date"
					id="dataPublicacao"
					name="dataPublicacao"
					[(ngModel)]="edicaoEditada.dataPublicacao"
					required
				/>
			</div>

			<div class="form-group">
				<label for="buscaEditora">Buscar Editora:</label>
				<input 
					id="buscaEditora" 
					type="text"
					name="buscaEditora"
					[(ngModel)]="termoBuscaEditora"
					(ngModelChange)="filtrarEditoras()"
					class="form-control"
					placeholder="Digite para buscar...">
			</div>

			<div class="form-group">
				<label for="editora">Editora: *</label>
				<select 
					id="editora" 
					name="editora" 
					[(ngModel)]="edicaoEditada.idEditora"
					required>
					<option value="">Selecione uma editora</option>
					<option *ngFor="let editora of editorasFiltradas" [value]="editora.idEditora || editora.id">
						{{ editora.nome }}
					</option>
				</select>
			</div>

			<div class="form-group">
				<label for="buscaIdioma">Buscar Idioma:</label>
				<input 
					id="buscaIdioma" 
					type="text"
					name="buscaIdioma"
					[(ngModel)]="termoBuscaIdioma"
					(ngModelChange)="filtrarIdiomas()"
					class="form-control"
					placeholder="Digite para buscar...">
			</div>

			<div class="form-group">
				<label for="idioma">Idioma: *</label>
				<select 
					id="idioma" 
					name="idioma" 
					[(ngModel)]="edicaoEditada.idIdioma"
					required>
					<option value="">Selecione um idioma</option>
					<option *ngFor="let idioma of idiomasFiltrados" [value]="idioma.idIdioma || idioma.id">
						{{ idioma.nome }}
					</option>
				</select>
			</div>

			<div class="form-group">
				<label for="qtdPaginas">Quantidade de P√°ginas: *</label>
				<input 
					type="number" 
					id="qtdPaginas" 
					name="qtdPaginas" 
					[(ngModel)]="edicaoEditada.qtdPaginas" 
					min="1"
					placeholder="Ex: 320" 
					required 
				/>
			</div>

			<div class="form-group">
				<label for="tipoCapa">Tipo de Capa: *</label>
				<select id="tipoCapa" name="tipoCapa" [(ngModel)]="edicaoEditada.tipoCapa" required>
					<option value="">Selecione o tipo de capa</option>
					<option value="dura">Capa dura</option>
					<option value="flexivel">Capa mole/flex√≠vel</option>
					<option value="brochura">Brochura</option>
					<option value="espiral">Espiral</option>
				</select>
			</div>

			<div class="form-group">
				<label for="tamanho">Tamanho do Livro: *</label>
				<select id="tamanho" name="tamanho" [(ngModel)]="edicaoEditada.tamanho" required>
					<option value="">Selecione o tamanho</option>
					<option value="pequeno">Pequeno</option>
					<option value="medio">M√©dio</option>
					<option value="grande">Grande</option>
				</select>
			</div>

			<div class="form-group">
				<label for="classificacao">Classifica√ß√£o Indicativa: *</label>
				<select id="classificacao" name="classificacao" [(ngModel)]="edicaoEditada.classificacao" required>
					<option value="">Selecione a classifica√ß√£o</option>
					<option value="l">Livre (L)</option>
					<option value="C10">10 anos</option>
					<option value="C12">12 anos</option>
					<option value="C14">14 anos</option>
					<option value="C16">16 anos</option>
					<option value="C18">18 anos</option>
				</select>
			</div>

			<div class="form-group">
				<label for="descricaoEdicao">Descri√ß√£o da Edi√ß√£o: *</label>
				<input 
					type="text" 
					id="descricaoEdicao" 
					name="descricaoEdicao" 
					[(ngModel)]="edicaoEditada.descricaoEdicao"
					placeholder="Ex: 1¬™ edi√ß√£o, Revisada, Ampliada..."
					maxlength="60"
					required 
				/>
				<small>M√°ximo 60 caracteres</small>
			</div>

			<div class="form-group">
				<label for="imagemEdicao">Imagem do livro:</label>
				<input 
					type="file" 
					id="imagemEdicao" 
					name="imagemEdicao" 
					accept="image/*"
					(change)="onImagemEdicaoChange($event)" 
				/>
				<small>Formatos aceitos: JPG, PNG, GIF. Tamanho m√°ximo: 5MB. Deixe em branco para manter a imagem atual.</small>
			</div>

			<div class="modal-actions">
				<button type="button" class="btn btn-outline" (click)="fecharModalEdicao()">Cancelar</button>
				<button type="button" class="btn btn-primary" (click)="salvarEdicao()">Salvar Altera√ß√µes</button>
			</div>
		</div>
	</div>
</main>
